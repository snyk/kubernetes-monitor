sudo: false
dist: xenial
language: node_js
cache:
  directories:
    - node_modules
notifications:
  email: false
  slack:
    on_failure: always
    on_success: never
    on_pull_requests: false
node_js:
  - '10'
before_install:
  - echo "//registry.npmjs.org/:_authToken=\${NPM_TOKEN}" > .npmrc
install:
  - npm install
jobs:
  include:
    # test stage
    - stage: Test
      script: npm run test
    # release and deploy stage
    # TODO when we can build and publish a container
    - stage: Release and deploy
      if: branch IN (master) AND type != pull_request
      script:
        - npx semantic-release
        - ./scripts/travis_after_success.sh
branches:
  only:
   - master
